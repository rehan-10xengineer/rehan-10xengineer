name: Update GitHub Profile README

on:
  schedule:
    - cron: '0 0 * * *' # daily at midnight UTC
  workflow_dispatch: # allows manual trigger

permissions:
  contents: write # allows pushing changes to the repo

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # fetch full history to get all commits

      - name: Set up Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git

      - name: Fetch co-authored commits from llama.cpp
        run: |
          # Replace <username> with your GitHub username
          # This example finds commits co-authored by you in llama.cpp
          mkdir -p tmp
          cd tmp
          git clone --depth=100 https://github.com/ggerganov/llama.cpp.git
          cd llama.cpp
          git log --all --grep="Co-authored-by: Your Name <your_email@example.com>" \
            --pretty=format:"* [%h](https://github.com/ggerganov/llama.cpp/commit/%H) %s" \
            > ../../COAUTHORED_COMMITS.md
          cd ../..
          # Append to your README.md or replace section
          echo "## My llama.cpp Co-authored Commits" > README.md
          cat COAUTHORED_COMMITS.md >> README.md

      - name: Commit and push changes
        run: |
          git add README.md
          git commit -m "Update llama.cpp co-authored commits [skip ci]" || echo "No changes to commit"
          git push origin main
